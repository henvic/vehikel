var can_finish_progressbar=false;function Zend_ProgressBar_Update(a){YAHOO.util.Dom.getElementsByClassName("percentage","div",document.getElementById("uploadprogress"))[0].style.width=parseInt(a.percent,10)+"%";if(a.percent>15){YAHOO.util.Dom.getElementsByClassName("percentage","div",document.getElementById("uploadprogress"))[0].innerHTML=parseInt(a.percent,10)+"%"}document.getElementById("uploadprogressinfo").innerHTML='<acronym title="Estimated Time of Arrival">ETA</acronym>: '+a.timeRemaining+" seconds; "+a.text;if(a.percent>80&&!can_finish_progressbar){can_finish_progressbar=true}}function Zend_ProgressBar_Finish(){if(can_finish_progressbar){YAHOO.util.Dom.getElementsByClassName("percentage","div",document.getElementById("uploadprogress"))[0].style.width="100%";YAHOO.util.Dom.getElementsByClassName("percentage","div",document.getElementById("uploadprogress"))[0].innerHTML="Finished";document.getElementById("uploadprogressinfo").innerHTML="Upload complete. Processing."}}
/*@end of workaround*/
var progressEvent=function(a){var b=YAHOO.util.Event.getTarget(a);document.getElementById("bandwidth").style.opacity=0.5;document.getElementById("bandwidthinfo").style.opacity=0.2;while(b.id!=="container"){setTimeout(getProgress,1000);break}};YAHOO.util.Event.addListener("submitupload","click",progressEvent);function makeRequest(b){var a;if(window.XMLHttpRequest){a=new XMLHttpRequest();if(a.overrideMimeType){a.overrideMimeType("text/xml")}}else{if(window.ActiveXObject){try{a=new ActiveXObject("Msxml2.XMLHTTP")}catch(c){try{a=new ActiveXObject("Microsoft.XMLHTTP")}catch(c){}}}}if(!a){return false}a.onreadystatechange=function(){evalProgress(a)};a.open("GET",b,true);a.send("")}function getProgress(){makeRequest("/progress/upload/?progress_key="+document.getElementById("progress_key").value)}function evalProgress(httpRequest){try{if(httpRequest.readyState==4){if(httpRequest.status==200){eval("var data = "+httpRequest.responseText);if(data.finished){Zend_ProgressBar_Finish()}else{Zend_ProgressBar_Update(data);setTimeout(getProgress,1000)}}else{document.getElementById("uploadprogressinfo").innerHTML="There was a problem with the progress request."}}}catch(e){document.getElementById("uploadprogressinfo").innerHTML="Error retrieving the progress."}}function observeProgress(){setTimeout(getProgress,1500)};