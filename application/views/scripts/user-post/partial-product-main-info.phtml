<?php
$translatePosts = $this->translatePosts;
/** @var $translatePosts \Zend_Translate_Adapter() */

$postForm = $this->postForm;

$userInfo = $this->userInfo;
$post = $this->post;

$editable = $this->editable;

$availableEquipment = $this->availableEquipment;

$price = '';
$priceOnInput = '';

if ($post["price"]) {
    $price = new Zend_Currency(array("symbol" => "R$ "), "pt_BR");
    $price->setValue($post["price"] / 100);

    $priceOnInput = "R$ " . number_format($post["price"] / 100, 2, ",", ".");
}

$km = '';

if ($post["km"]) {
    $km = number_format($post["km"], 0, ".", ".");
}

$fuel = '';

if ($post["fuel"]) {
    $fuel = $translatePosts->translate($post["fuel"]);
}

$transmission = '';

if ($post["transmission"]) {
    $transmission = $translatePosts->translate($post["transmission"]);
}

$traction = '';

if ($post["traction"]) {
    $traction = $translatePosts->translate($post["traction"]);
}

$postProductInfoData = [
    "price" => [
        "name" => "price",
        "title" => "Preço",
        "input_value" => $priceOnInput,
        "value" => $price,
        "input" => ""
    ],
    "model_year" => [
        "name" => "model_year",
        "title" => "Ano",
        "input_value" => $post["model_year"],
        "value" => $post["model_year"],
        "input" => ""
    ],
    "km" => [
        "name" => "km",
        "title" => "km",
        "input_value" => $post["km"],
        "value" => $km,
        "input" => ""
    ],
    "fuel" => [
        "name" => "fuel",
        "title" => "Combustível",
        "input_value" => $post["fuel"],
        "value" => $fuel,
        "input" => ""
    ],
    "transmission" => [
        "name" => "transmission",
        "title" => "Câmbio",
        "input_value" => $post["transmission"],
        "value" => $transmission,
        "input" => ""
    ],
    "traction" => [
        "name" => "traction",
        "title" => "Tração",
        "input_value" => $post["traction"],
        "value" => $traction,
        "input" => ""
    ]
];

if ($editable) {
    $postProductInfoData["price"]["input"] = '<input type="text" name="price" id="price" value="' .
        $this->escape($priceOnInput) . '" placeholder="R$ 00.000,00" ' .
        'class="input-medium input-main-info input-text-main-info editable-value none" maxlength="16">';

    $postProductInfoData["model_year"]["input"] = $postForm->getElement("model_year")->removeDecorator("wrapper")
        ->removeDecorator("label")
        ->removeDecorator("htmltag")
        ->removeDecorator("description");

    $postProductInfoData["km"]["input"] = '<input type="text" name="km" id="km" value="' .
        $this->escape($post["km"]) . '" class="input-mini input-main-info input-text-main-info editable-value none"' .
        ' maxlength="16">';

    $postProductInfoData["fuel"]["input"] = $postForm->getElement("fuel")->removeDecorator("wrapper")
        ->removeDecorator("label")
        ->removeDecorator("htmltag")
        ->removeDecorator("description");

    $postProductInfoData["transmission"]["input"] = $postForm->getElement("transmission")->removeDecorator("wrapper")
        ->removeDecorator("label")
        ->removeDecorator("htmltag")
        ->removeDecorator("description");

    $postProductInfoData["traction"]["input"] = $postForm->getElement("traction")->removeDecorator("wrapper")
        ->removeDecorator("label")
        ->removeDecorator("htmltag")
        ->removeDecorator("description");
}
?>
<table id="post-product-info"
 class="post-product-info table table-striped table-hover<?= ($editable) ? ' editable' : '' ?>"><tbody>
<?php
foreach ($postProductInfoData as $productInfo) {
?>
<tr class="element tr-<?= $this->escape($productInfo["name"]); ?>"
data-name="<?= $this->escape($productInfo["name"]); ?>">
<td class="name"><strong class="pull-right"><?= $this->escape($productInfo["title"]); ?></strong></td>
<td class="value value-on" data-saved-value="<?= $this->escape($productInfo["input_value"]); ?>">
<span class="text-value">
<?php
$escapedValue = '<span class="muted">-</span>';

if ($productInfo["value"]) {
    $escapedValue = $this->escape($productInfo["value"]);
}

echo $escapedValue;
?>
</span>
<?php
if ($editable) {
?>
<label for="<?= $this->escape($productInfo["name"]); ?>" class="hidden">
<?= $this->escape($productInfo["title"]); ?></label>
<?= $productInfo["input"]; ?>
<span class="pull-right">
<button class="btn btn-mini pull-right edit-button action" tabindex="100"><i class="icon-edit"></i></button>
</span>
<?php
}
?>
</td>
</tr>
<?php
}
unset($productInfo);
?>
</tbody></table><!-- end of .post-product-info -->
<small class="pull-right muted"><abbr title="referência">ref</abbr>: #<?= $this->escape($post["universal_id"]); ?></small>
<div class="post-product-info-others" id="post-product-info-others">
<?php
if ($post["type"] == "car" && ($post["armor"] || $editable)) {
?>
<?= ($editable) ? '<label class="label-checkbox-armor label-checkbox">' : "" ?>
<span class="label label-important<?= ($post["armor"]) ? ' has' : ' has-not' ?>">
<?php
if ($editable) {
?>
<label for="armor" class="hidden">Blindado</label>
<input id="armor" name="armor" type="checkbox"<?= ($post["armor"]) ? ' checked="checked"' : ''; ?> tabindex="120" />
<?php
}
?>
Blindado
</span>
<?= ($editable) ? "</label>" : "" ?>
<?php
}

if ($post["handicapped"] || $editable) {
?>
<?= ($editable) ? '<label class="label-checkbox-handicapped label-checkbox">' : "" ?>
<span class="label label-handicapped<?= ($post["handicapped"]) ? ' has' : ' has-not' ?>"
data-rel="tooltip" data-placement="bottom" title="para deficientes físicos">
<?php
if ($editable) {
?>
<label for="handicapped" class="hidden">Adaptado</label>
<input id="handicapped" name="handicapped"
type="checkbox"<?= ($post["handicapped"]) ? ' checked="checked"' : ''; ?> tabindex="121" />
<?php
}
?>
<i class="icon-vehicle-adapted"></i> Adaptado
</span>
<?= ($editable) ? "</label>" : "" ?>
<?php
}

if ($post["collection"] || $editable) {
    ?>
    <?= ($editable) ? '<label class="label-checkbox-collection label-checkbox">' : "" ?>
    <span class="label label-inverse<?= ($post["collection"]) ? ' has' : ' has-not' ?>"
          data-rel="tooltip" data-placement="bottom" title="colecionador">
<?php
if ($editable) {
    ?>
    <label for="collection" class="hidden">Colecionador</label>
    <input id="collection" name="collection"
           type="checkbox"<?= ($post["collection"]) ? ' checked="checked"' : ''; ?> tabindex="122" />
<?php
}
?>
        Colecionador
</span>
    <?= ($editable) ? "</label>" : "" ?>
<?php
}

if ($editable) {
    echo $this->render("user-post/post-status.phtml");
}
?>
</div>
