<?php

$userInfo = $this->userInfo;

$paginator =  $this->posts;
/** @var $paginator \Zend_Paginator() */

$posts = $paginator->getCurrentItems();

$postsPictures = $this->postsPictures;

?>
<table id="posts-table-view" class="posts-list posts-table-view table table-striped table-hover<?= ($this->postsViewStyle !== "table") ? " hidden" : ""; ?>">
<?php
foreach ($posts as $post) {
    $escapedPostLink = $this->url(
        array("username" => $userInfo['username'], "post_id" => $post['id']), "user_post"
    );

    $price = new Zend_Currency(array("symbol" => "R$&nbsp;"), "pt_BR");
    $price->setValue($this->escape($post["price"] / 100));
?>
<tr data-link="<?= $escapedPostLink; ?>" id="post-id-<?= $this->escape($post["id"]); ?>-row">
<td class="span1">
<?php
if (isset($postsPictures[$post["id"]][0]) && is_array($postsPictures[$post["id"]][0])) {
$picture = $postsPictures[$post["id"]][0];
?>
<?= $this->picture($picture["id"], "square.jpg"); ?>
<?php
} else {
?>
<img src="<?= $this->staticVersion("/images/chevrolet-impala-icon-square.png"); ?>" alt="picture placeholder">
<?php
}
?>
</td>
<td>
<div class="span4">
<a href="<?= $escapedPostLink; ?>">
<?= $this->escape($post["make"] . " " . $post["model"] . " " . $post["engine"] . " " . $post["name"]); ?></a>
 <span class="muted">#<?= $this->escape($post["universal_id"]); ?></span><br />
<?= $this->escape($post["model_year"]); ?>
<?php
if ($post["km"] != "") {
?><span class="muted"> | </span><?= $this->escape($post["km"]); ?> km
<?php
}
?>
</div>
<div class="span2 special-items">
<?php
$specialItems = [];

if ($post["armor"]) {
    $specialItems[] = 'Blindado';
}

if ($post["armor"]) {
    $specialItems[] = 'Adaptado';
}

if ($post["transmission"] == 'automatic') {
    $specialItems[] = 'AutomÃ¡tico';
}

if ($post["traction"] == '4x4') {
    $specialItems[] = '4x4';
}

$sizeOfSpecialItems = count($specialItems);

for ($counter = 0; $counter < $sizeOfSpecialItems; $counter++)
{
    echo $specialItems[$counter];

    if ($counter != $sizeOfSpecialItems - 1) {
?>
<br />
<?php
        }
    }
?>
</div>
</td>
<td class="post-listing-price">
<?= $price; ?>
<?php
if ($this->editable && $post["status"] == "active") {
?>
 <button class="btn btn-mini end pull-right" data-id="<?= $this->escape($post["id"]); ?>">
     finalizar
 </button>
<?php
}
?>
</td>
</tr>
<?php
}
?>
</table>
